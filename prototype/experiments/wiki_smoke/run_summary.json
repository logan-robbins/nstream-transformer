2025-10-02T15:06:57Z | STEP  | [4] BEGIN: Summarise run
2025-10-02T15:06:57Z | STEP  | [4] CMD: python scripts/summarize_run.py experiments/wiki_smoke
{
  "config": {},
  "evaluation": {
    "manifest": {
      "checkpoint_path": "/Users/loganrobbins/thesis_4_v1/experiments/wiki_smoke/checkpoints/step_000005.json",
      "config_hash": "00eb898462bd86905ce8224253d6f6beae570d3913dc243ae395d96f484906b9",
      "config_path": "/Users/loganrobbins/thesis_4_v1/configs/wiki_smoke.yaml",
      "dataset": {
        "exists": true,
        "mtime": 1759372412.755288,
        "path": "data/processed/wiki_smoke/multistream.jsonl",
        "size": 1693173
      },
      "metrics": {
        "ablations": [],
        "agreement": {
          "f1": 0.0,
          "precision": 0.0,
          "recall": 0.0,
          "records": 10.0
        },
        "coverage": {
          "articles": 10,
          "avg_entities_per_article": 871.6,
          "compactness_mean": 0.0060186210834107644,
          "compactness_within_range_ratio": 0.0,
          "coverage_entries": 0,
          "cross_references": 0,
          "definition_count": 5,
          "entity_persistence": 1.0,
          "fact_count": 0,
          "fact_coverage": 0.0,
          "inconsistency_rate": 0.0,
          "notes_ratio_target": {
            "max": 0.2,
            "min": 0.1
          },
          "reconstruction_score": 0.004513664805250643,
          "total_entities": 8716,
          "unique_entities": 3719
        },
        "latency": {
          "alpha": 0.0,
          "beta": 0.0,
          "gamma": 0.0
        },
        "rollback": {
          "avg_confidence": 1.0,
          "evaluations": 16.5,
          "rollback_events": 0.0
        }
      },
      "metrics_path": "experiments/wiki_smoke/evaluation/metrics.json",
      "model_config": {
        "latent_dim": 512,
        "model_dim": 1024,
        "moe": {
          "expert_dim": 512,
          "num_experts": 2,
          "router_temperature": 1.0,
          "router_type": "softmax"
        },
        "planner": {
          "latent_dim": 128,
          "max_plan_tokens": 128,
          "model_dim": 256,
          "num_heads": 4,
          "num_layers": 2
        },
        "roles": [
          {
            "adapter_rank": 4,
            "name": "intro",
            "notes_layers": 1,
            "surface_layers": 1
          },
          {
            "adapter_rank": 4,
            "name": "core",
            "notes_layers": 1,
            "surface_layers": 1
          },
          {
            "adapter_rank": 4,
            "name": "wrap",
            "notes_layers": 1,
            "surface_layers": 1
          }
        ],
        "rotary_dim": 128,
        "speculative": {
          "agreement_threshold": 0.7,
          "agreement_window": 6,
          "cadence_rho": 1.0,
          "emission_probability": 1.0,
          "gate_init": 1.0,
          "gate_max": 1.0,
          "gate_min": 0.0,
          "max_notes_tokens": 64,
          "max_snapshots": 2,
          "min_notes_tokens": 16,
          "mtp_proposals": 2,
          "notes_interval": 8,
          "read_lag": 1,
          "stride_size": 8,
          "topk_notes": 4
        },
        "token_specials": {
          "commit": "<commit>",
          "notes": "<notes>",
          "plan": "<plan>",
          "rollback": "<rollback>"
        },
        "vocab_size": 32000
      },
      "timestamp": 1759417616.9042099,
      "tokenizer_manifest": {
        "added_tokens": [
          "<plan>",
          "<notes>",
          "<rollback>",
          "<commit>"
        ],
        "identifier": "bert-base-uncased",
        "is_fast": true,
        "padding_side": "right",
        "source": "pretrained",
        "special_tokens": [
          "<plan>",
          "<notes>",
          "<rollback>",
          "<commit>"
        ],
        "tokenizer_class": "BertTokenizerFast",
        "truncation_side": "right",
        "vocab_size": 30522
      },
      "training_config": {
        "batch_size": 16,
        "curriculum": [
          {
            "description": "Teacher forcing on outlines",
            "enabled_losses": [
              "planner_ce"
            ],
            "name": "planner_pretrain"
          },
          {
            "description": "Surface/notes lanes with gold notes",
            "enabled_losses": [
              "surface_ce",
              "notes_ce"
            ],
            "name": "role_bootstrap"
          },
          {
            "description": "Parallel decoding with lagged notes",
            "enabled_losses": [
              "surface_ce",
              "notes_ce",
              "stability"
            ],
            "name": "notes_bus_enable"
          },
          {
            "description": "Agreement head stress tests",
            "enabled_losses": [
              "surface_ce",
              "notes_ce",
              "rollback"
            ],
            "name": "rollback_training"
          },
          {
            "description": "Twin pass CE+KL alignment",
            "enabled_losses": [
              "surface_ce",
              "notes_ce",
              "spec_invariance"
            ],
            "name": "speculative_invariance"
          }
        ],
        "eval_interval": 50,
        "grad_accum_steps": 1,
        "gradnorm_alpha": 1.5,
        "gradnorm_eta": 0.01,
        "gradnorm_lambda_bounds": [
          0.1,
          0.9
        ],
        "gradnorm_update_steps": 20,
        "log_interval": 5,
        "max_records": 400,
        "max_seq_len": 512,
        "max_steps": 100,
        "mixed_precision": "bf16",
        "multistream_dataset": "data/processed/wiki_smoke/multistream.jsonl",
        "optimizer": {
          "beta1": 0.9,
          "beta2": 0.95,
          "lr": 0.0001,
          "weight_decay": 0.01
        },
        "planner_dataset": "data/processed/wiki_smoke/planner.jsonl",
        "schema_report_path": "data/processed/wiki_smoke/schema_report.json",
        "telemetry_dir": "experiments/wiki_smoke/telemetry",
        "tokenizer_manifest": null,
        "tokenizer_name": "bert-base-uncased"
      }
    },
    "metrics": {
      "ablations": [],
      "agreement": {
        "f1": 0.0,
        "precision": 0.0,
        "recall": 0.0,
        "records": 10.0
      },
      "coverage": {
        "articles": 10,
        "avg_entities_per_article": 871.6,
        "compactness_mean": 0.0060186210834107644,
        "compactness_within_range_ratio": 0.0,
        "coverage_entries": 0,
        "cross_references": 0,
        "definition_count": 5,
        "entity_persistence": 1.0,
        "fact_count": 0,
        "fact_coverage": 0.0,
        "inconsistency_rate": 0.0,
        "notes_ratio_target": {
          "max": 0.2,
          "min": 0.1
        },
        "reconstruction_score": 0.004513664805250643,
        "total_entities": 8716,
        "unique_entities": 3719
      },
      "latency": {
        "alpha": 0.0,
        "beta": 0.0,
        "gamma": 0.0
      },
      "rollback": {
        "avg_confidence": 1.0,
        "evaluations": 16.5,
        "rollback_events": 0.0
      }
    }
  },
  "run_dir": "experiments/wiki_smoke",
  "telemetry": {
    "manifest": {
      "checkpoint": "experiments/wiki_smoke/checkpoints/step_000005.json",
      "config_hash": "00eb898462bd86905ce8224253d6f6beae570d3913dc243ae395d96f484906b9",
      "config_path": "/Users/loganrobbins/thesis_4_v1/configs/wiki_smoke.yaml",
      "evaluation": {
        "latency": 0.0,
        "rollback": 1.0
      },
      "global_step": 5,
      "model_config": {
        "latent_dim": 512,
        "model_dim": 1024,
        "moe": {
          "expert_dim": 512,
          "num_experts": 2,
          "router_temperature": 1.0,
          "router_type": "softmax"
        },
        "planner": {
          "latent_dim": 128,
          "max_plan_tokens": 128,
          "model_dim": 256,
          "num_heads": 4,
          "num_layers": 2
        },
        "roles": [
          {
            "adapter_rank": 4,
            "name": "intro",
            "notes_layers": 1,
            "surface_layers": 1
          },
          {
            "adapter_rank": 4,
            "name": "core",
            "notes_layers": 1,
            "surface_layers": 1
          },
          {
            "adapter_rank": 4,
            "name": "wrap",
            "notes_layers": 1,
            "surface_layers": 1
          }
        ],
        "rotary_dim": 128,
        "speculative": {
          "agreement_threshold": 0.7,
          "agreement_window": 6,
          "cadence_rho": 1.0,
          "emission_probability": 1.0,
          "gate_init": 1.0,
          "gate_max": 1.0,
          "gate_min": 0.0,
          "max_notes_tokens": 64,
          "max_snapshots": 2,
          "min_notes_tokens": 16,
          "mtp_proposals": 2,
          "notes_interval": 8,
          "read_lag": 1,
          "stride_size": 8,
          "topk_notes": 4
        },
        "token_specials": {
          "commit": "<commit>",
          "notes": "<notes>",
          "plan": "<plan>",
          "rollback": "<rollback>"
        },
        "vocab_size": 32000
      },
      "multistream_dataset": {
        "exists": true,
        "mtime": 1759372412.755288,
        "path": "data/processed/wiki_smoke/multistream.jsonl",
        "size": 1693173
      },
      "planner_dataset": {
        "exists": true,
        "mtime": 1759372412.755448,
        "path": "data/processed/wiki_smoke/planner.jsonl",
        "size": 3245
      },
      "schema_report": {
        "articles": 10,
        "avg_entities_per_article": 871.6,
        "compactness_mean": 0.0060186210834107644,
        "compactness_within_range_ratio": 0.0,
        "coverage_entries": 0,
        "cross_references": 0,
        "definition_count": 5,
        "entity_persistence": 1.0,
        "fact_count": 0,
        "fact_coverage": 0.0,
        "inconsistency_rate": 0.0,
        "notes_ratio_target": {
          "max": 0.2,
          "min": 0.1
        },
        "reconstruction_score": 0.004513664805250643,
        "total_entities": 8716,
        "unique_entities": 3719
      },
      "stage_history": [
        {
          "batches": 1.0,
          "loss": 0.0,
          "planner_loss": 4.385988712310791
        },
        {
          "batches": 1.0,
          "coverage_loss": 2.4,
          "grad_ratio": 0.5,
          "lambda_ce": 0.5,
          "lambda_kl": 0.5,
          "lambda_std": 0.0,
          "loss": NaN,
          "nli": 0.9903877377510071,
          "notes_ce": 0.0,
          "notes_usage": NaN,
          "redundancy": NaN,
          "role_adherence": 1.69970703125,
          "rollback_loss": 0.0,
          "spec_ce": 0.0,
          "spec_kl": 0.0,
          "stability_loss": 4.8,
          "surface_ce": 10.385988235473633,
          "training_rate_divergence": 0.0
        },
        {
          "batches": 1.0,
          "coverage_loss": 2.4,
          "grad_ratio": 0.5,
          "lambda_ce": 0.5,
          "lambda_kl": 0.5,
          "lambda_std": 0.0,
          "loss": NaN,
          "nli": 1.113481044769287,
          "notes_ce": 0.0,
          "notes_usage": NaN,
          "redundancy": NaN,
          "role_adherence": 1.5687235593795776,
          "rollback_loss": 0.0,
          "spec_ce": 0.0,
          "spec_kl": 0.0,
          "stability_loss": 4.8,
          "surface_ce": 10.385988235473633,
          "training_rate_divergence": 0.0
        },
        {
          "batches": 1.0,
          "coverage_loss": 2.4,
          "grad_ratio": 0.5,
          "lambda_ce": 0.5,
          "lambda_kl": 0.5,
          "lambda_std": 0.0,
          "loss": NaN,
          "nli": 1.4850181341171265,
          "notes_ce": 0.0,
          "notes_usage": NaN,
          "redundancy": NaN,
          "role_adherence": 1.731895089149475,
          "rollback_loss": 0.0,
          "spec_ce": 0.0,
          "spec_kl": 0.0,
          "stability_loss": 4.8,
          "surface_ce": 10.385988235473633,
          "training_rate_divergence": 0.0
        },
        {
          "batches": 1.0,
          "coverage_loss": 2.4,
          "grad_ratio": 0.5,
          "lambda_ce": 0.5,
          "lambda_kl": 0.5,
          "lambda_std": 0.0,
          "loss": NaN,
          "nli": 1.240096926689148,
          "notes_ce": 0.0,
          "notes_usage": NaN,
          "redundancy": NaN,
          "role_adherence": 1.322518229484558,
          "rollback_loss": 0.0,
          "spec_ce": 0.0,
          "spec_kl": 0.0,
          "stability_loss": 4.8,
          "surface_ce": 10.385988235473633,
          "training_rate_divergence": 0.0
        }
      ],
      "stages_file": "train_run_stages.json",
      "steps_file": "train_run_steps.jsonl",
      "telemetry_dir": "experiments/wiki_smoke/telemetry",
      "telemetry_metadata": {
        "batch_size": 16,
        "config_hash": "00eb898462bd86905ce8224253d6f6beae570d3913dc243ae395d96f484906b9",
        "config_path": "/Users/loganrobbins/thesis_4_v1/configs/wiki_smoke.yaml",
        "max_records": 400,
        "multistream_dataset": {
          "exists": true,
          "mtime": 1759372412.755288,
          "path": "data/processed/wiki_smoke/multistream.jsonl",
          "size": 1693173
        },
        "planner_dataset": {
          "exists": true,
          "mtime": 1759372412.755448,
          "path": "data/processed/wiki_smoke/planner.jsonl",
          "size": 3245
        },
        "tokenizer": {
          "identifier": "bert-base-uncased",
          "source": "pretrained"
        }
      },
      "telemetry_schema_version": "1.0",
      "timestamp": 1759417614.9485838,
      "tokenizer_manifest": {
        "added_tokens": [
          "<plan>",
          "<notes>",
          "<rollback>",
          "<commit>"
        ],
        "identifier": "bert-base-uncased",
        "is_fast": true,
        "padding_side": "right",
        "source": "pretrained",
        "special_tokens": [
          "<plan>",
          "<notes>",
          "<rollback>",
          "<commit>"
        ],
        "tokenizer_class": "BertTokenizerFast",
        "truncation_side": "right",
        "vocab_size": 30522
      },
      "tokenizer_manifest_path": "experiments/wiki_smoke/telemetry/tokenizer_manifest.json",
      "training_config": {
        "batch_size": 16,
        "curriculum": [
          {
            "description": "Teacher forcing on outlines",
            "enabled_losses": [
              "planner_ce"
            ],
            "name": "planner_pretrain"
          },
          {
            "description": "Surface/notes lanes with gold notes",
            "enabled_losses": [
              "surface_ce",
              "notes_ce"
            ],
            "name": "role_bootstrap"
          },
          {
            "description": "Parallel decoding with lagged notes",
            "enabled_losses": [
              "surface_ce",
              "notes_ce",
              "stability"
            ],
            "name": "notes_bus_enable"
          },
          {
            "description": "Agreement head stress tests",
            "enabled_losses": [
              "surface_ce",
              "notes_ce",
              "rollback"
            ],
            "name": "rollback_training"
          },
          {
            "description": "Twin pass CE+KL alignment",
            "enabled_losses": [
              "surface_ce",
              "notes_ce",
              "spec_invariance"
            ],
            "name": "speculative_invariance"
          }
        ],
        "eval_interval": 50,
        "grad_accum_steps": 1,
        "gradnorm_alpha": 1.5,
        "gradnorm_eta": 0.01,
        "gradnorm_lambda_bounds": [
          0.1,
          0.9
        ],
        "gradnorm_update_steps": 20,
        "log_interval": 5,
        "max_records": 400,
        "max_seq_len": 512,
        "max_steps": 100,
        "mixed_precision": "bf16",
        "multistream_dataset": "data/processed/wiki_smoke/multistream.jsonl",
        "optimizer": {
          "beta1": 0.9,
          "beta2": 0.95,
          "lr": 0.0001,
          "weight_decay": 0.01
        },
        "planner_dataset": "data/processed/wiki_smoke/planner.jsonl",
        "schema_report_path": "data/processed/wiki_smoke/schema_report.json",
        "telemetry_dir": "experiments/wiki_smoke/telemetry",
        "tokenizer_manifest": null,
        "tokenizer_name": "bert-base-uncased"
      }
    },
    "stages_file": "experiments/wiki_smoke/telemetry/train_run_stages.json",
    "steps_file": "experiments/wiki_smoke/telemetry/train_run_steps.jsonl"
  }
}
2025-10-02T15:06:57Z | STEP  | [4] END: Summarise run (duration=0s, rc=0)
